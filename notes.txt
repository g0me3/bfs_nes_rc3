СТАРЫЕ БАГИ

* Самый известный и раздражающий "баг" - это прерывание музыки при сменах экранов на титульнике. Происходит это частично из-за того, что функция проигрывания рассована по разным местам циклов событий, а не один раз в конце NMI (хотя видимо это было сделано, чтобы не решать проблему коллизий при смене банков). Но в основном из-за того, что на смену экрана требуется довольно много времени, во время которого NMI тоже отключаются, так что лаги бы не пропали.

* При переходе на пятый уровень после уничтожения ходячего робота количество очков, набранное в текущем уровне сбрасывается до уровня предыдущего, которое было сохранено предварительно перед окончанием третьего. Если в четвертом уровне получить геймовер, при попадании к ниндзя очков станет, естественно, ноль. Одновременно это влечет также восстановление параметров игрока на момент четвертого уровня, то есть пропадет результат ремонта в конце четвертого, но восстановится здоровье до момента его начала.

* Управление пропуском экранов геймовера и концовки, включая экран ввода имени в таблицу очков выполнено на основе таймеров, то есть вместо того, чтобы по нажатию кнопки прыгать на нужную ветку кода или пропускать ненужную, изменяется параметр таймера и программа начинает ходить по другим веткам сама, возможно это сделано для переинициализации таймеров титула перед его рестартом, возможно по какой-то другой не совсем явной причине. Но работает это из рук вон плоховато. Экран очков может скипануться сразу же после попадания в него, а титульник перескочить сразу на начало игры, либо сразу с геймовера в игру через два экрана.

* После окончания игры меню продолжения должно становиться неактивным и игру можно начинать с нуля. Но если в конце игры очков для продолжения недостаточно (а это может спокойно произойти в результате предыдущего бага), и экрана ввода имени не появлялась, курсор меню становится по умолчанию на продолжении, хотя оно все равно не работает.

* Количество энергии и эффективность Робокопа оценивается по 8-битной циклической суме процентов защиты. Это подразумевает теоретическую ситуацию, когда сумма ненулевых процентов защиты становится нулем с переполнением и персонаж взрывается. Требуется проверка практической возможности такого варианта в игре. Скорее всего в игре не проявляется.

* В последнем уровне при истечении таймера происходит немедленный гамовер без каких бы то ни было сообщений. Между тем, перед выходом программа устанавливает запрос на отображение сообщения с индексом 0х1А в строке состояния. В таблице указателей последний индекс - 0х19. Но в блоке текстовых сообщений в самом конце имеется неиспользованная строчка "OUT OF TIME". Очевидно, этот баг просмотрели и если бы не происходил немедленный выход, игру бы сглючивало.

* В последнем уровне таймер времени отображает минуты и секунды отдельно через пробел, но в коде игры между двумя цифрами ставится ненулевой индекс тайла, который, тем не менее, не имеет графики. Подразумевалось, что здесь будет двоеточие, но оно не было нарисовано по тем или иным причинам.

* Спрайты для дорисовки живота РобоКопа на титульнике выброшены, так как конфликтуют со спрайтами меню. Требуется переработка фотмата меню, чтобы вернуть их назад, а также поправить палитру для этого спрайта.

* В движке игры не предусмотрено специального спрайта для спрайт 0 хит эффекта, каждый раз используется наболее подходящий. В некоторых местах это похоже скорее на глюки, так как часть таких спрайтов вылезает сквозь задник.

ИСПРАВЛЕННЫЕ СТАРЫЕ БАГИ

* При первом появлении робокопа на уровне возле головы вспыхивает и пропадает облачко взрыва, хотя дамажа не отмечается. Происходит потому, что функция расчета общего состояния и инициализация переменной происходят позже, чем проверка на необходимость рисовать анимацию взрыва. этого хватает, чтобы на первом кадре добавился объект взрыва. На втором кадре переменная инициализируется и взрыв останавливается.

* На экране ремонтной лаборатории два последних спрайта из состава оверлея перезаписываются поверх спрайтом ремонтного элемента, от чего пропадает кусок платформы под правой ногой робокопа.

* Звездное поле на первом запуске после титульника стартует в неинициализированном виде, с нулей, но так как в самой процедуре есть автоматическая генерация новых звезд, это заметно только в первые секунды начала анимации, когда поле совершенно пустое и летит одна звездочка, но потом вылетают все остальные. В двух других местах игры перед показом звездного поля, все 20 звезд генерятся предварительно.

* В игре есть две одинаковых функции конвертирования 16-битного 16-ричного числа в пять десятичных в буфере. Одна находится и используется в банке 5, другая - в 7. Причем код обеих процедур довольно универсальный и может использоваться в обоих банках одинаково.

* Отображение количества ремонтных контейнеров использует только 1 символ, если число больше 9, предусмотрено отображение одиночного символа. Но по тем или иным причинам, этот символ - знак процента, а не 9. В игре, к дающимся изначально пяти контейнерам, дополнительно можно собрать еще 6, так что получаем

ИЗМЕНЕНИЯ

* Как обычно чистка, избавление от ненужного кода, удаление дубликатов процедур.

* Все вызовы проигрывания музыки убраны из неигровых обработчиков и циклов и внесены один раз в обработчик NMI. Должно быть достаточно безопасно, пока весь неигровой код находится исключительно в банке 5.

* Копирайтный экран почему-то рисовался с помощью процедуры рисования БИОС от брифинга перед игрой. Для этого даже специально добавили пустое сообщение в таблицу. Текст копирайтов впечатывался поверх нарисованного, и если не стереть заголовок биоса, остается левый текста между строк. Ребята это тупо исправили забиванием отдельно пустой строки в тексте копирайтов. Убрал это из них, поменял процедуру вывода текста БИОС на просто рисование стандартного окна.

* Шрифты неигровой части приведены к одному типу, теперь интро перед стартом игры и все игровые брифинги и копирайты в одной кодировке, так что можно использовать одну общую функцию вывода и убрать коррекции индексов тайлов.

* Добавлено звездное поле на экране копирайтов.

* В списке сообщений есть одно под индексом "убирайся отсюда". Видимо предназначалось для финального брифинга в конце уровня, но по каким-то причинам так и не было использовано.

ВНУТРЯНКА

* В игре как минимум три разных дефолтных таблицы рекордов. Одна используется на старте, одна врисована в дефолтную тайловую карту экрана таблицы рекордов (в ней есть неизвстное имя, повторенное 4 раза) и одна совершенно неиспользованная. В последней имена разработчиков такие же, только 6 и 4 поменяны местами и другие очки игроков с максимум в более чем миллион.

* Игра изначально планировалась для двух игроков поочереди на одном контроллере, от этого остались внутренний индекс текущего игрока, бекапы параметров игроков в отдельный архивный массив и выборка их перед новым уровнем. Хотя инитится оба бекапа, индекс игрока в игре никогда не меняется и всегда выбирается только нулевой. В некоторых случаях игра выбирает переменные форсом без учета текущего игрока, как например продолжения - она считает их только у первого игрока, одновременно переменная бекапа континуя для первого игрока работает как глобальная переменная текущего количества континуев и не переписывается в отдельную переменную, как все другие параметры.

* Дефолтная тайловая карта строки состояния игрока содержит строку текста, которая никогда не отображается в игре, так как сразу же затирается другими сообщениями: "A SAMPLE MESSAGE".

* Перед стартом уровня один раз рассчитывается порог отказа четырех подсистем персонажа, исходя из текущих процентов защиты после починки или продолжения игры. Каждая подсистема с процентом ниже 18 становится потенциальным источником сбоев. Если какой-то из параметров упал ниже уровня во время игры, это не влияет на появление отказов. Отказ той или иной системы персонажа во время игры рассчитывается раз в 100 кадров (примерно раз в 1.5 секунды). Случайным  образом выбирается одна из четырех подсистем и проверяется порог ее отказа. В случае превышения порога, с вероятностью 0.2 выбранной подсистеме выставляется флаг отказа. Если система была в отказе, а очередная проверка на отказ дала отрицательный результат, система восстанавливается с сообщением "ЗАЩИЩАТЬ НЕВИНОВНЫХ". Таким образом каждый отдельный цикл отказа может продолжаться не более 1.5 секунды, но может быть возобновлен на следующие 1.5 секунды или заменен отказом другой.

* В банке графики строки состояния практически нет пустого места. Между тем, там сидят целых четыре разных набора символов для отображения цифр, причем два предназначены для строки сообщений. Ни один из этих двух наборов в игре не используется, так как все сообщения цифр не содержат. При необходимости увеличения количества оружия, можно убрать эти ненужные цифры, на крайний случай оставить только один из них и возможно добавить какие-то сообщения, их использующие.

* Когда игрок встает на транспортер о втором уровне и тот его несет вперед, при достижении середины экрана вместе с перемещением автоматически включается скролл и скроллит персонажа вместе с экраном, также, как и при обычном перемещении, за это отвечает отдельная ветка в процедуре перемещения на транспортере. В ней же есть отдельная проверка, которая проверяет, не находится ли персонаж в самом конце уровня, стоя на транспортере, если да, то автоскролл пропускается. Таким образом производится своего рода защита уровня от лишнего скролла, так как сам по себе он сделан костылем поверх движка. Но в конце уровня в финальной версии нет достаточно длинного транспортера, чтобы сработала данная защитная ветка, остаток уровня все равно приходится идти ногами и там уже скролл блокируется движком автоматически. По всей видимости, на этапе разработки транспортер был длиннее и сначала сделали такую вот проверку, но потом просто решили укоротить транспортер. Возможно ветка оставлена по соображениям дальнейших возможных изменений уровня, когда транспортер опять может появиться.

* Пламя от ракетного сопла в третьем уровне у робокопа странно подглючивает. При перемещении горизонтально оно может не только смещаться вправо-влево от нормального значения, но и отделяться от ранца, показывая дыру между ним и пламенем.

* В ремонтной лаборатории некоторые тайлы графики не используются в финальной версии, хотя тайловые карты присутствуют. Тайловые карты оверлеев для рисования повреждений ног имеют размер 8х6, но используются только 8х5. Если сравнить полный вариант с неполным, видно, что большая часть тайлов в этом оверлее совпадает с изначальной тайловой картой без повреждений, а его нижняя последняя строка отличается только в одном последнем кадре при максимальном повреждении. Но основной причиной отключения этой лишней строки является, скорее всего, то, что сам оверлей своей последней строкой затирает один из тайлов неменяющейся части картинки (вертикальную полосу, видно на скриншотах при сравнении), этого можно было бы избежать при изменении формата данных для вывода на экран и соответственно процедур, но так как, судя по всему, игра разрабатывалась довольно быстро, формат простынки кода для вывода графики этого не позволял сделать без дополнительных усилий. Так что исправлен этот глюк был простым отключением части кода, рисовавшего последнуюю строку оверлея. Код до сих пор присутствует в ПЗУ игры. Совершенно неиспользованным остался отдельный третий оверлей повреждений левой руки игрока. В текущей версии их используется два: заменяется целиком предплечье правой руки и небольшой участок предплечья левой. Третий должен был рисовать повреждение кисти левой руки и состоять из битмапов 4х4. Причин неиспользования может быть несколько. Во-первых, сам оверлей 4х4 имеет совершенно пустую нижнюю строку, которая бы точно затирала часть исходной тайловой карты, но даже если ее не использовать, что несложно, на экране повреждения кисти выглядят неестественно и довольно странно, так как все остальные конечности так не повреждаются. По всей видимости данный оверлей решено было не использовать еще на ранней стадии разработки, а код, если он даже и был, совершенно удалить из ПЗУ по причине того, что он занимал бы слишком много места.

* Некоторые статичные экраны в игре имеют спрайтовый патч для увеличения диапазона отображаемых цветов. Процедура рисования законченного экрана хранит таблицу таких патчей. В отличие от запакованных тайловых карт, патч спрайта - это практически пустой битмап 32х27, где ненулевыми индексами обозначен второй слой картинки, который и преобразуется в спрайты программно. На один такой битмап уходит 864 байта. Всего их должно быть три, но для экрана концовки игры просто не хватило места, патчи этого экрана пишутся напрямую опкодами в спрайтовый буфер в процедуре инициализации рисования. Судя по всему у ребят было так мало времени, что они даже не успели сконвертировать эти патчи во что-то более простое, например в голые спрайтовые данные, либо не было времени писать для этого отдельные инструменты, а проще было дописать процедурку для конвертирования на лету в программе.